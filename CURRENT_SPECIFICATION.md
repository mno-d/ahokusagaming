# ヒット&ブロー・ローグライク - 現在の仕様書

## 1. ゲーム概要

**ジャンル**: 数字当てゲーム × ローグライク  
**プラットフォーム**: Webブラウザ（React + Vite）  
**対応デバイス**: PC、タブレット、スマートフォン  

## 2. コアゲームプレイ

### 2.1 基本ルール
- **目標**: 3桁の秘密コード（0-9の数字を重複なし）を当てる
- **ターン制限**: 最大10ターン
- **勝利条件**: 秘密コードを完全に当てる（HIT = 3）
- **敗北条件**: 10ターン以内に当てられない

### 2.2 フィードバックシステム
- **HIT**: 正解の数字が正解の位置にある
- **BLOW**: 正解の数字が含まれているが、位置が異なる

**例**:
- 秘密コード: "123"
- プレイヤーの推測: "135"
- 結果: HIT = 1（"1"が正解）, BLOW = 1（"3"が含まれているが位置が違う）

### 2.3 入力システム
- **数字パッド**: 0-9の数字をクリックして選択
- **制約**: 同じ数字は2回選択できない
- **入力スロット**: 3つの入力欄に数字を順番に入力
- **操作**: DEL（削除）、ENTER（送信）ボタン

## 3. ゲーム進行システム

### 3.1 ステージシステム
- **ステージ数**: 無制限（理論上）
- **難易度**: ステージが進むにつれて難易度が上昇する（予定）
- **進行方法**: 各ステージをクリアすると次のステージに進む

### 3.2 スコアシステム

**スコア計算式**:
```
ステージスコア = (基本スコア + ターンボーナス) × コンボ倍率
```

**詳細**:
- **基本スコア**: 1000点
- **ターンボーナス**: (最大ターン数 - 現在のターン数) × 100
  - 例: 1ターンで正解 → (10 - 1) × 100 = 900点ボーナス
- **コンボ倍率**: 連続クリアで上昇（1.0から開始、クリアごとに+0.1）
  - 1ステージ目クリア: 1.0倍
  - 2ステージ目クリア: 1.1倍
  - 3ステージ目クリア: 1.2倍

### 3.3 進行要件（REQUIRED_SCORES）
```
ステージ1: 1,200点必要
ステージ2: 1,600点必要
ステージ3: 2,100点必要
ステージ4: 2,600点必要
ステージ5: 3,200点必要
ステージ6: 3,900点必要
ステージ7: 4,700点必要
ステージ8: 5,600点必要
ステージ9: 6,600点必要
ステージ10: 9,500点必要
```

## 4. UI/UXデザイン

### 4.1 デザインテーマ
**スタイル**: サイバーパンク・ネオン

**色彩**:
- **背景**: 深い青紫（oklch(0.15 0.05 270)）
- **プライマリ**: シアン（oklch(0.7 0.15 190)）
- **アクセント**: ネオンピンク（oklch(0.6 0.2 320)）
- **セカンダリ**: ネオングリーン（oklch(0.7 0.2 140)）

**フォント**:
- **ディスプレイ**: Orbitron（見出し・数字）
- **本体**: Roboto Mono（テキスト）
- **技術**: Share Tech Mono（ログ表示）

### 4.2 画面構成

**メイン画面**:
1. **HUDヘッダー**: ステージ、スコア、ターン、コンボ倍率を表示
2. **入力スロット**: 3つの数字入力欄
3. **数字パッド**: 0-9のボタン
4. **アクションボタン**: DEL、ENTER
5. **ログエリア**: 過去の推測履歴を表示

**オーバーレイ**:
- **クリア画面**: "CLEARED!"メッセージ、正解コード表示、次ステージボタン
- **失敗画面**: "FAILED"メッセージ、正解コード表示、リスタートボタン

## 5. 機能実装状況

### ✅ 実装済み機能
- [x] 基本的なヒット&ブロー判定ロジック
- [x] 3桁コード生成（重複なし）
- [x] スコア計算システム
- [x] コンボシステム（基本）
- [x] ステージ進行システム
- [x] UI/UXデザイン（サイバーパンク）
- [x] サウンドエフェクト（Web Audio API）
- [x] チュートリアル機能
- [x] ローカルストレージ保存（ハイスコア、ステージ）
- [x] レスポンシブデザイン

### ⏳ 未実装機能
- [ ] カードシステム（定義のみ、実装なし）
- [ ] パワーアップアイテム
- [ ] 難易度選択（イージー/ノーマル/ハード）
- [ ] グローバルランキング
- [ ] ユーザーアカウント
- [ ] アチーブメント/バッジシステム
- [ ] マルチプレイ
- [ ] ゲーム内通貨システム
- [ ] スキンシステム（定義のみ）
- [ ] ボスステージ
- [ ] チャレンジモード

## 6. データ構造

### 6.1 ゲーム状態（GameState）
```typescript
{
  coins: number;           // ゲーム内通貨
  highScore: number;       // 最高スコア
  highStage: number;       // 到達した最高ステージ
  ownedSkins: string[];    // 所有しているスキン
  equippedSkin: string;    // 装備中のスキン
}
```

### 6.2 ラン状態（RunState）
```typescript
{
  stage: number;           // 現在のステージ
  score: number;           // 現在のスコア
  deck: number[];          // 使用しているカードID
  hp: number;              // HP（未使用）
  combo: number;           // コンボ数
  comboMult: number;       // コンボ倍率
}
```

### 6.3 ステージ状態（StageState）
```typescript
{
  answer: string;          // 秘密コード
  guesses: Array<{         // 推測履歴
    guess: string;
    hit: number;
    blow: number;
  }>;
  turn: number;            // 現在のターン
  isClear: boolean;        // クリア判定
  isGameOver: boolean;     // ゲームオーバー判定
}
```

## 7. カード定義（実装予定）

現在10種類のカードが定義されていますが、ゲーム内では未実装です：

| ID | 名前 | タイプ | ティア | 効果 |
|---|---|---|---|---|
| 1 | ハイ&ロー | ヒント | 1 | 正解の合計が15以上か14以下か判明 |
| 2 | 奇数偶数 | ヒント | 1 | 正解の奇数・偶数の個数が判明 |
| 3 | レンジ | ヒント | 1 | 正解の最大数字-最小数字の差が判明 |
| 4 | 合計値 | ヒント | 2 | 正解の3つの数字の合計が判明 |
| 5 | ワン・モア | 特殊 | 2 | 残りターン数が+2される |
| 6 | スナイパー | 倍率 | 1 | 1ターン目で正解するとスコア3倍 |
| 7 | ラストホープ | 倍率 | 1 | 残り1ターンで正解するとスコア2.5倍 |
| 8 | スピードスター | 倍率 | 2 | 3ターン以内正解でスコア1.5倍 |
| 9 | コンボマスター | コンボ | 2 | コンボ倍率の上昇量が+0.1される |
| 10 | ラッキーセブン | 条件 | 1 | 正解に7が含まれていればスコア+500 |

## 8. 技術スタック

- **フロントエンド**: React 19 + TypeScript
- **ビルドツール**: Vite
- **スタイリング**: Tailwind CSS 4 + shadcn/ui
- **状態管理**: React Context + useState
- **ストレージ**: localStorage
- **サウンド**: Web Audio API
- **ルーティング**: Wouter

## 9. パフォーマンス

- **初期ロード時間**: < 2秒（開発環境）
- **フレームレート**: 60 FPS
- **メモリ使用量**: < 50MB

## 10. ブラウザ互換性

- Chrome/Edge: ✅ 完全対応
- Firefox: ✅ 完全対応
- Safari: ✅ 完全対応
- IE11: ❌ 非対応

---

**最終更新**: 2025年12月17日  
**バージョン**: 1.0.0
